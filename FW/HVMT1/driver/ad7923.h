/*
 * ad7923.h
 *
 * Created: 2022-11-30 오후 5:47:42
 *  Author: YJKIM
 */ 

#ifndef AD7923_H_
#define AD7923_H_

#include "SPI.h"
#include "timer.h"

#define AD7923_CHIP_MAX	8
#define AD7923_CH_MAX	4
#define AD_AVR_MAX	5
#define AD_READ_DELAY	5
#define AD_AVR_DELAY	5

#define AD7923_CS1		portf.bit0
#define AD7923_CS2		portf.bit1
#define AD7923_CS3		portf.bit2
#define AD7923_CS4		portf.bit3
#define AD7923_CS5		portf.bit4
#define AD7923_CS6		portf.bit5
#define AD7923_CS7		portf.bit6
#define AD7923_CS8		portf.bit7

#define AD7923_SPCR	(0<<SPIE)|(1<<SPE)|(0<<DORD)|(1<<MSTR)|(0<<CPOL)|(1<<CPHA)|(0<<SPR1)|(0<<SPR0)
#define AD7923_SPSR	(0<<SPIF)|(1<<SPI2X)

#define AD7923_SPI_SET1	(1<<WRITE)|(1<<SEQ1)|(1<<DONTC9)|(1<<DONTC8)|(1<<ADD1)|(1<<ADD0)|(1<<PM1)|(1<<PM0)
#define AD7923_SPI_SET2	(1<<SEQ0)|(0<<DONTC2)|(0<<RANGE)|(1<<CODING)

#define AD_MAX_VOLTAGE	5555000UL	//AD MAX Voltage 55.55V
#define AD_MAX_ADC		4095UL	//AD MAX ADC Value 12bit

#define DEF_VOL_VAL	(AD_MAX_VOLTAGE/AD_MAX_ADC)

enum{PM0, PM1, ADD0, ADD1, DONTC8, DONTC9, SEQ1, WRITE};
enum{CODING=4, RANGE, DONTC2, SEQ0};

enum{AD7923_CHIP1, AD7923_CHIP2, AD7923_CHIP3, AD7923_CHIP4
	, AD7923_CHIP5, AD7923_CHIP6, AD7923_CHIP7, AD7923_CHIP8};

enum{AD7923_CH1, AD7923_CH2, AD7923_CH3, AD7923_CH4};

#define AI_1	AD7923_Avr[AD7923_CHIP8][AD7923_CH1]
#define AI_2	AD7923_Avr[AD7923_CHIP8][AD7923_CH2]
#define AI_3	AD7923_Avr[AD7923_CHIP8][AD7923_CH3]
#define AI_4	AD7923_Avr[AD7923_CHIP8][AD7923_CH4]
#define AI_5	AD7923_Avr[AD7923_CHIP7][AD7923_CH1]
#define AI_6	AD7923_Avr[AD7923_CHIP7][AD7923_CH2]
#define AI_7	AD7923_Avr[AD7923_CHIP7][AD7923_CH3]
#define AI_8	AD7923_Avr[AD7923_CHIP7][AD7923_CH4]
#define AI_9	AD7923_Avr[AD7923_CHIP3][AD7923_CH3]
#define AI_10	AD7923_Avr[AD7923_CHIP3][AD7923_CH4]

#define AD_V12_VOL	AD7923_Avr[AD7923_CHIP6][AD7923_CH3]
#define AD_IN_VOL	AD7923_Avr[AD7923_CHIP6][AD7923_CH4]

#define AD_DO1_VOL	AD7923_Avr[AD7923_CHIP5][AD7923_CH1]
#define AD_DO2_VOL	AD7923_Avr[AD7923_CHIP5][AD7923_CH2]
#define AD_DO3_VOL	AD7923_Avr[AD7923_CHIP5][AD7923_CH3]
#define AD_DO4_VOL	AD7923_Avr[AD7923_CHIP5][AD7923_CH4]
#define AD_DO5_VOL	AD7923_Avr[AD7923_CHIP6][AD7923_CH1]
#define AD_DO6_VOL	AD7923_Avr[AD7923_CHIP6][AD7923_CH2]

#define AD_DO1_CUR	AD7923_Avr[AD7923_CHIP2][AD7923_CH1]
#define AD_DO2_CUR	AD7923_Avr[AD7923_CHIP2][AD7923_CH2]
#define AD_DO3_CUR	AD7923_Avr[AD7923_CHIP2][AD7923_CH3]
#define AD_DO4_CUR	AD7923_Avr[AD7923_CHIP2][AD7923_CH4]
#define AD_DO5_CUR	AD7923_Avr[AD7923_CHIP3][AD7923_CH1]
#define AD_DO6_CUR	AD7923_Avr[AD7923_CHIP3][AD7923_CH2]

#define AD_RY1_VOL	AD7923_Avr[AD7923_CHIP4][AD7923_CH1]
#define AD_RY2_VOL	AD7923_Avr[AD7923_CHIP4][AD7923_CH2]
#define AD_RY3_VOL	AD7923_Avr[AD7923_CHIP4][AD7923_CH3]
#define AD_RY4_VOL	AD7923_Avr[AD7923_CHIP4][AD7923_CH4]

#define AD_RY1_CUR	AD7923_Avr[AD7923_CHIP1][AD7923_CH1]
#define AD_RY2_CUR	AD7923_Avr[AD7923_CHIP1][AD7923_CH2]
#define AD_RY3_CUR	AD7923_Avr[AD7923_CHIP1][AD7923_CH3]
#define AD_RY4_CUR	AD7923_Avr[AD7923_CHIP1][AD7923_CH4]

#define IN_VOL		((AD_IN_VOL*DEF_VOL_VAL)/100)
#define V12_VOL		((AD_V12_VOL*DEF_VOL_VAL)/100)
#define FOUT1_VOL	((AD_DO1_VOL*DEF_VOL_VAL)/100)
#define FOUT2_VOL	((AD_DO2_VOL*DEF_VOL_VAL)/100)
#define FOUT3_VOL	((AD_DO3_VOL*DEF_VOL_VAL)/100)
#define FOUT4_VOL	((AD_DO4_VOL*DEF_VOL_VAL)/100)
#define FOUT5_VOL	((AD_DO5_VOL*DEF_VOL_VAL)/100)
#define FOUT6_VOL	((AD_DO6_VOL*DEF_VOL_VAL)/100)

unsigned long AD7923_data[AD7923_CHIP_MAX][AD7923_CH_MAX][AD_AVR_MAX];
unsigned long AD7923_Avr[AD7923_CHIP_MAX][AD7923_CH_MAX];

void Init_AD7923(void);
void Read_AD7923(void);
void Avr_AD7923(void);
#endif /* AD7923_H_ */